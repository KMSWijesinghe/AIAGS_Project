<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>View Portfolio List</title>
    <link rel="stylesheet" href="css/styles.css" />
</head>

<body>
    <div class="container">
        <!-- Sidebar -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <div class="main-content">
            <h1 class="page-title" style="text-align: center;">View Portfolio</h1>

            <div class="content-card">
                <div class="filter-section">
                    <div class="filter-group">
                        <span class="filter-label">Select:</span>
                        <select class="filter-select" id="selectBatch">
                            <option value="">Select Batch</option>
                            <option value="2024">Batch 2024</option>
                            <option value="2023">Batch 2023</option>
                            <option value="2022">Batch 2022</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <span class="filter-label">Filter:</span>
                        <span class="filter-label">Status</span>
                        <select class="filter-select" id="filterStatus">
                            <option value="">Select Status</option>
                            <option value="approved">Approved</option>
                            <option value="pending">Pending</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <span class="filter-label">Grade</span>
                        <select class="filter-select" id="filterGrade">
                            <option value="">Select Grade</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <span class="filter-label">Assignment</span>
                        <select class="filter-select" id="filterAssignment">
                            <option value="">Select Assignment</option>
                            <option value="assignment1">Assignment 1</option>
                            <option value="assignment2">Assignment 2</option>
                            <option value="assignment3">Assignment 3</option>
                            <option value="assignment4">Assignment 4</option>
                        </select>
                    </div>

                    <div class="search-group">
                        <span class="filter-label">Search Student:</span>
                        <input type="text" class="search-input" id="searchStudent" placeholder="" />
                    </div>

                    <button class="print-button" onclick="window.print()">ðŸ–¨</button>
                </div>

                <div class="table-container portfolio-table">
                    <div class="table-header">
                        <div class="table-header-cell">STUDENT NO</div>
                        <div class="table-header-cell">PORTFOLIO</div>
                        <div class="table-header-cell">STATUS</div>
                        <div class="table-header-cell">FINAL GRADE</div>
                        <div class="table-header-cell">VIEW REPORT</div>
                    </div>

                    <div class="table-body" id="tableBody">

                        <!-- Add batch + assignment info here -->
                        <div class="table-row" data-batch="2024" data-assignment="assignment1" data-portfolio-id="1">
                            <div class="table-cell">ME/2020/001</div>
                            <div class="table-cell">username_251120</div>
                            <div class="table-cell status-approved">Approved</div>
                            <div class="table-cell">B</div>
                            <div class="table-cell">
                                <span class="view-icon" role="button" tabindex="0" title="View Report">ðŸ“„</span>
                            </div>
                        </div>

                        <div class="table-row" data-batch="2023" data-assignment="assignment2" data-portfolio-id="2">
                            <div class="table-cell">ME/2020/002</div>
                            <div class="table-cell">username_251120</div>
                            <div class="table-cell status-pending">Pending</div>
                            <div class="table-cell"></div>
                            <div class="table-cell"></div>
                        </div>

                        <div class="table-row empty-row">
                            <div class="table-cell"></div>
                            <div class="table-cell"></div>
                            <div class="table-cell"></div>
                            <div class="table-cell"></div>
                            <div class="table-cell"></div>
                        </div>

                        <div class="table-row empty-row">
                            <div class="table-cell"></div>
                            <div class="table-cell"></div>
                            <div class="table-cell"></div>
                            <div class="table-cell"></div>
                            <div class="table-cell"></div>
                        </div>

                        <div class="table-row empty-row">
                            <div class="table-cell"></div>
                            <div class="table-cell"></div>
                            <div class="table-cell"></div>
                            <div class="table-cell"></div>
                            <div class="table-cell"></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sidebar load
        fetch("sidebar.html")
            .then(r => r.text())
            .then(html => {
                document.getElementById("sidebar-container").innerHTML = html;
                const currentLink =
                    document.querySelector('.nav-link[data-page="portfolio"]') ||
                    document.querySelector('.nav-button[data-page="portfolio"]');
                if (currentLink) currentLink.classList.add("active");
            })
            .catch(err => console.error("Failed to load sidebar:", err));

        // Ensure all listeners attach properly
        document.addEventListener("DOMContentLoaded", () => {
            const selectBatch = document.getElementById("selectBatch");
            const filterStatus = document.getElementById("filterStatus");
            const filterGrade = document.getElementById("filterGrade");
            const filterAssignment = document.getElementById("filterAssignment");
            const searchStudent = document.getElementById("searchStudent");

            // If any element missing, stop to avoid "not responding" JS errors
            if (!selectBatch || !filterStatus || !filterGrade || !filterAssignment || !searchStudent) {
                console.error("Filter elements missing. Check IDs in HTML.");
                return;
            }

            selectBatch.addEventListener("change", filterTable);
            filterStatus.addEventListener("change", filterTable);
            filterGrade.addEventListener("change", filterTable);
            filterAssignment.addEventListener("change", filterTable);
            searchStudent.addEventListener("input", filterTable);

            filterTable();
        });

        function filterTable() {
            const batchFilter = document.getElementById("selectBatch").value;               // "2024"
            const statusFilter = document.getElementById("filterStatus").value.toLowerCase(); // "approved"
            const gradeFilter = document.getElementById("filterGrade").value;               // "A"
            const assignmentFilter = document.getElementById("filterAssignment").value;     // "assignment1"
            const searchText = document.getElementById("searchStudent").value.toLowerCase();

            const rows = document.querySelectorAll(".table-row:not(.empty-row)");

            rows.forEach(row => {
                const cells = row.querySelectorAll(".table-cell");

                const studentNo = (cells[0]?.textContent || "").toLowerCase();
                const status = (cells[2]?.textContent || "").toLowerCase();
                const grade = (cells[3]?.textContent || "").trim();

                const rowBatch = row.dataset.batch || "";
                const rowAssignment = row.dataset.assignment || "";

                let show = true;

                if (batchFilter && rowBatch !== batchFilter) show = false;
                if (statusFilter && !status.includes(statusFilter)) show = false;
                if (gradeFilter && grade !== gradeFilter) show = false;
                if (assignmentFilter && rowAssignment !== assignmentFilter) show = false;
                if (searchText && !studentNo.includes(searchText)) show = false;

                row.style.display = show ? "grid" : "none";
            });
        }

        // View report action
        document.addEventListener("click", (e) => {
            const icon = e.target.closest(".view-icon");
            if (!icon) return;

            const row = icon.closest(".table-row");
            const portfolioId = row?.dataset?.portfolioId;

            // Replace with your real navigation
            if (portfolioId) {
                // Example: window.location.href = `view_report.html?portfolio_id=${portfolioId}`;
                alert("Open report for portfolio_id = " + portfolioId);
            } else {
                alert("No portfolio_id found on this row.");
            }
        });
    </script>
</body>

</html>